<!doctype html>
<html>

<head>
  <link rel="stylesheet" type="text/css" href="test.css" />
  <link rel="stylesheet" type="text/css" href="reset.css" />
</head>

<body>
  <div id="intro">
    <div id="title-wrap">
      <h1>Up in Smoke </h1>
      <img src="imgs/flame.svg">
    </div>

    <div id="text-wrap">
      <p>This is a time-model on the effect of wildfires in the state of California. Using this model, you can select many of the variables that most affect the time and course that wild fires may take in different circumstances. Other factors are set into the map, such as elevation and regional biome. Your job is to set the variable, click the starting point of the fire on the map, and click "Ignite!" Watch as the fire travels along, spreading quickly through some areas and completely ignoring others. We hope that such a model will one day help civilians evacuate and aid firefighters in organizing a response.
      </p>
    </div>
  </div>

  <div id="form-wrap">
    <h2>Advance</h2>

    <form id="entryForm">
      <div class="input-wrap">
        <h3>Wind Speed:</h3
        ><input type="number">
      </div>

      <div class="input-wrap">
        <h3>Wind Direction:</h3
        ><input type="number">
      </div>

      <div class="input-wrap">
        <h3>Humidity:</h3
        ><input type="number">
      </div>

      <div class="input-wrap">
        <h3>Variable 4:</h3
        ><input type="number">
      </div>

      <div class="input-wrap">
        <h3>Variable 5:</h3
        ><input type="number">
      </div>
    </form>
  </div>


  <div id="fire-simulation-wrap">
    <canvas id="board"></canvas>

    <div id="slider-wrap">
      <h3>Frame</h3>
      <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
    </div>
  </div>



  <div id="resources-wrap">
    <div id="resources">
      <div id="exit-wrap">
        <img src="imgs/exit.svg">
      </div>

      <ul>
        <a href="#" target=_blank>Link 1</a>
        <a href="#" target=_blank>Link 1</a>
        <a href="#" target=_blank>Link 1</a>
        <a href="#" target=_blank>Link 1</a>
        <a href="#" target=_blank>Link 1</a>
        <ul>
    </div>
  </div>

  <div id="footer">
    <p>Created in 36 hours at Spartahack IV</p>
    <img src="imgs/spartahack.svg">
  </div>

  <script>
    const server = "http://35.22.93.201:5000/startsimulation";
    let frames = 0;
    let sub = '';
    let curFrame = 0;

    function displayImage(subDir, frameNumber) {
      const canvas = document.getElementById('board').getContext('2d');
      console.log('Getting image');
      const img = new Image();
      img.src = `http://35.22.93.201:5000/imgs/${subDir}/frame_${frameNumber}.png`;
      img.onload = () => {
        canvas.drawImage(img, 0, 0);
      };
    }

    const slider = document.getElementById('myRange');
    slider.onchange = () => {
      displayImage(sub, slider.value);
    };

    function execute() {
      // Call the flask server
      var xhr = new XMLHttpRequest();
      xhr.open('POST', server, true);
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.onload = function(e) {
        if (this.status == 200) {
          console.log(this.responseText);
          const jsObj = JSON.parse(this.responseText);
          frames = jsObj.Frames;
          sub = jsObj.Subdir;

          slider.min = 1;
          slider.max = frames;
          // setInterval(loopImages,1000);
          displayImage(jsObj.Subdir, 1);
          slider.value = 1;
        }
      };

      xhr.send(JSON.stringify({
        'test': 1
      }));
    }
  </script>
</body>

</html>
